# SmartLightSensor v 0.7

Модуль для автоматического управления головным светом автомобиля. Построен на базе модуля **esp32c3 super mini**. Может управлять как габаритными огнями и ближним светом фар, так и дневными ходовыми огнями. Настройка модуля осуществляется с помощью Web-интерфейса.

При запуске двигателя модуль включает головной свет (в зависимости от времени суток), а при остановке двигателя (выключении зажигания) – отключает его. Включение и выключение света может выполняться с настраиваемой задержкой.

Модуль позволяет отключить автоматический режим и управлять головным светом в ручном режиме штатными переключателями.

- [Дневные ходовые огни](#дневные-ходовые-огни)
- [Индикация](#индикация)
- [Использованные сторонние библиотеки](#использованные-сторонние-библиотеки)

### Дневные ходовые огни

Модуль позволяет управлять дневными ходовыми огнями (ДХО). Для включения этой возможности нужно задать макрос `#define USE_RELAY_FOR_DRL 1` и пин выхода реле в файле **header_file.h**.

В принципе правильно установленные и подключенные ДХО в управлении не нуждаются - они автоматически включаются при запуске двигателя и выключаются при включении ближнего света (габаритных огней). Однако, если Вы хотите, чтобы ДХО включались не в момент запуска двигателя, а с заданной задержкой, можно поручить включение ДХО модулю. В этом случае ДХО будут включаться модулем, а отключение при включении ближнего света (габаритных огней) будет лежать на совести самих ДХО ))

Если же ДХО на Вашем автомобиле не имеют опции автоотключения при включении ближнего света фар, или же вместо ДХО используются, например, противотуманные фары, модуль может взять на себя полное управление ДХО. Для этого нужно задать макрос `#define USE_DRL_MANAGEMENT 1` в файле **header_file.h**. В этом случае состояние выхода реле ДХО будет зависеть от состояния выхода реле габаритных огней (габаритные огни включены - ДХО выключены и наоборот).

### Индикация

Модуль имеет светодиодный индикатор для отображения текущего режима работы и состояния головного света автомобиля. Для индикации используется адресный светодиод WS2811.

Цвета индикатора имеют следующие значения:
- Автоматический режим выключен:
  - Красный – управление головным светом выполняется вручную штатными переключателями;
- Автоматический режим включен
  - Двигатель не заведен
    -	Зеленый – свет не горит;
  - Двигатель заведен
    - Желтый (оранжевый) – ближний свет фар не включен; работает ДХО (если задано);
    - Голубой – включен ближний свет фар;

Пины для подключени кнопки, светодиода, выходов реле, входных сигналов и датчика света определены в файле **header_file.h**

***

### Использованные сторонние библиотеки

FastLED.h - https://github.com/FastLED/FastLED (при использовании версии аддона для **esp32** **3.0** и выше нужно использовать версию **FastLed** не ниже **3.9**)<br>
shButton.h - https://github.com/VAleSh-Soft/shButton <br>
ArduinoJson.h - https://github.com/bblanchon/ArduinoJson - работа с данными в формате JSON (код писался с использованием версии 6.21.5, ниже версии 6.0 код скорее всего не будет компилироваться, с версиями 7.0 и выше работа не тестировалась);<br>

***

Если возникнут вопросы, пишите на valesh-soft@yandex.ru 